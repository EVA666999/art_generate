# Stable Diffusion WebUI API Integration

## Описание проекта
Этот проект представляет собой интеграцию с Stable Diffusion WebUI через API, позволяющую генерировать изображения с использованием различных моделей и настроек. **Дополнительно интегрирован интеллектуальный чат-бот, который может общаться с пользователями и генерировать изображения через Stable Diffusion на основе диалога.** Проект реализован с использованием FastAPI и предоставляет удобный интерфейс для работы с Stable Diffusion.

## Основные возможности
- Генерация изображений через API
- **Интеллектуальный чат-бот с интеграцией Stable Diffusion**
- **Автоматическая генерация изображений в процессе диалога**
- Поддержка различных моделей Stable Diffusion
- Интеграция с ControlNet
- Асинхронная обработка запросов
- Docker-контейнеризация для простого развертывания

## Требования
- Python 3.8+
- Stable Diffusion WebUI
- Docker (опционально)

## Технологии

### AI и Генерация изображений
- **Stable Diffusion** - модель для генерации изображений на основе текстовых описаний
- **ControlNet** - расширение для точного контроля генерации изображений
- **LoRA** - технология для тонкой настройки моделей Stable Diffusion
- **Llama GGUF** - локальные языковые модели для чат-бота
- **VAE (Variational Autoencoder)** - для улучшения качества генерируемых изображений
- **CLIP** - модель для понимания и анализа текстовых описаний
- **    ** - улучшенная версия Stable Diffusion с поддержкой высокого разрешения
- **DeepFloyd IF** - многоступенчатая модель для генерации изображений
- **Kandinsky** - альтернативная модель для генерации изображений

### Основной стек
- **FastAPI** - современный веб-фреймворк для создания API с высокой производительностью
- **Pydantic** - библиотека для валидации данных и сериализации
- **Uvicorn** - ASGI сервер для запуска FastAPI приложений
- **Python-dotenv** - загрузка переменных окружения из .env файлов
- **Requests** - HTTP клиент для взаимодействия с Stable Diffusion WebUI API
- **Pillow** - библиотека для работы с изображениями
- **Aiohttp** - асинхронный HTTP клиент/сервер
- **Torch** - фреймворк для работы с нейронными сетями
- **Diffusers** - библиотека для работы с диффузионными моделями
- **Transformers** - библиотека для работы с трансформерными моделями

### Инфраструктура
- **Docker** - контейнеризация приложения
- **Docker Compose** - оркестрация контейнеров
- **Git** - система контроля версий
- **CUDA** - поддержка GPU для ускорения генерации
- **NVIDIA Container Toolkit** - для работы с GPU в контейнерах

### Мониторинг и логирование
- **Loguru** - продвинутое логирование
- **Prometheus** - мониторинг метрик
- **Grafana** - визуализация метрик
- **Weights & Biases** - отслеживание экспериментов с моделями

### Тестирование
- **Pytest** - фреймворк для тестирования
- **Pytest-asyncio** - поддержка асинхронного тестирования
- **Pytest-cov** - измерение покрытия кода тестами
- **FID (Fréchet Inception Distance)** - метрика для оценки качества генерируемых изображений

## Установка

### Локальная установка
1. Клонируйте репозиторий:
```bash
git clone [URL репозитория]
cd [название директории]
```

2. Создайте виртуальное окружение и активируйте его:
```bash
python -m venv venv
source venv/bin/activate  # для Linux/Mac
venv\Scripts\activate     # для Windows
```

3. Установите зависимости:
```bash
pip install -r requirements.txt
```

### Установка через Docker
1. Соберите Docker-образ:
```bash
docker-compose build
```

2. Запустите контейнер:
```bash
docker-compose up -d
```

## Использование

### Запуск API сервера
```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000 --reload
```

### Основные эндпоинты
- `POST /generate` - генерация изображения
- `GET /models` - получение списка доступных моделей
- `GET /status` - проверка статуса сервера
- **`POST /api/v1/chat/{character_id}` - чат с персонажем**
- **`GET /api/v1/chat/status` - статус чат-сервиса**
- **`POST /api/v1/characters/` - создание персонажей для чат-бота**

## Структура проекта
```
├── app/                    # Основной код приложения
│   ├── chat_bot/          # Система чат-бота с интеграцией SD
│   ├── auth/              # Система аутентификации
│   ├── database/          # Работа с базой данных
│   └── ...                # Остальные компоненты
├── models/                 # Модели и схемы данных
├── outputs/               # Директория для сгенерированных изображений
├── stable-diffusion-webui/ # Интеграция с Stable Diffusion WebUI
├── Dockerfile.api         # Конфигурация Docker
├── docker-compose.yml     # Конфигурация Docker Compose
└── requirements.txt       # Зависимости проекта
```

## Конфигурация
Основные настройки находятся в файле конфигурации. Вы можете настроить:
- URL Stable Diffusion WebUI
- Параметры генерации по умолчанию
- Настройки API

## Разработка
1. Создайте новую ветку для ваших изменений
2. Внесите необходимые изменения
3. Создайте pull request

## Лицензия
[Укажите вашу лицензию]

## Поддержка
Если у вас возникли вопросы или проблемы, создайте issue в репозитории проекта.

## Использование чат-бота

### Создание персонажа
```python
from app.chat_bot.schemas.chat import CharacterConfig

character = CharacterConfig(
    name="Алиса",
    personality="Дружелюбная помощница, которая может создавать изображения",
    background="Виртуальный ассистент с доступом к генерации изображений",
    speaking_style="Говорит дружелюбно и может предложить создать картинку"
)
```

### Чат с генерацией изображений
Чат-бот может автоматически предлагать и создавать изображения в процессе диалога, используя Stable Diffusion API для генерации картинок на основе контекста разговора. 