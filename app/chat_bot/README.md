# ü§ñ –ß–∞—Ç-–±–æ—Ç —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º

–ß–∞—Ç-–±–æ—Ç –Ω–∞ –±–∞–∑–µ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏ Llama —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é —Å–æ–∑–¥–∞–Ω–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞–º–∏, —Å—Ç–∏–ª—è–º–∏ —Ä–µ—á–∏ –∏ –ø—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è–º–∏.

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏** - —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞–º–∏
- **–õ–æ–∫–∞–ª—å–Ω–∞—è –º–æ–¥–µ–ª—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å GGUF –º–æ–¥–µ–ª—è–º–∏ Llama –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- **–ì–∏–±–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ø–æ–¥ —Å–≤–æ–∏ –Ω—É–∂–¥—ã
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - —É—Å–∫–æ—Ä–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞** - –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –Ω–µ–∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ llama-cpp-python (–¥–ª—è Windows –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π wheel)
pip install llama_cpp_python-0.2.89-cp310-cp310-win_amd64.whl

# –ò–ª–∏ –¥–ª—è Linux/Mac
pip install llama-cpp-python
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–æ–¥–µ–ª–∏

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `app/chat_bot/config/chat_config.py`:

```python
MODEL_PATH: str = "–ø—É—Ç—å/–∫/–≤–∞—à–µ–π/–º–æ–¥–µ–ª–∏.gguf"
```

### 3. –ü—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç

```bash
python app/chat_bot/test_chat.py
```

### 4. –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

```bash
python app/chat_bot/examples/chat_example.py
```

## üé≠ –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞

```python
from app.chat_bot.schemas.chat import CharacterConfig

character = CharacterConfig(
    name="–ò–º—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    personality="–û–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏ –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞",
    background="–ü—Ä–µ–¥—ã—Å—Ç–æ—Ä–∏—è –ø–µ—Ä—Å–æ–Ω–∞–∂–∞",
    speaking_style="–°—Ç–∏–ª—å —Ä–µ—á–∏ –∏ –º–∞–Ω–µ—Ä–∞ –æ–±—â–µ–Ω–∏—è",
    interests=["–∏–Ω—Ç–µ—Ä–µ—Å1", "–∏–Ω—Ç–µ—Ä–µ—Å2"],
    mood="—Ç–µ–∫—É—â–µ–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ",
    additional_context={}  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç
)
```

### –ü—Ä–∏–º–µ—Ä—ã –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π

#### –î—Ä—É–∂–µ–ª—é–±–Ω–∞—è –ê–ª–∏—Å–∞
```python
alice = CharacterConfig(
    name="–ê–ª–∏—Å–∞",
    personality="–î—Ä—É–∂–µ–ª—é–±–Ω–∞—è –∏ –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–∞—è –¥–µ–≤—É—à–∫–∞, –∫–æ—Ç–æ—Ä–∞—è –ª—é–±–∏—Ç –æ–±—â–∞—Ç—å—Å—è –∏ –ø–æ–º–æ–≥–∞—Ç—å –ª—é–¥—è–º.",
    background="–ê–ª–∏—Å–∞ - –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫, —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¥–ª—è –æ–±—â–µ–Ω–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.",
    speaking_style="–ì–æ–≤–æ—Ä–∏—Ç –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç–º–æ–¥–∑–∏ –∏ –≤—ã—Ä–∞–∂–∞–µ—Ç —ç–º–æ—Ü–∏–∏.",
    interests=["–æ–±—â–µ–Ω–∏–µ", "–ø–æ–º–æ—â—å –ª—é–¥—è–º", "—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏", "—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ"],
    mood="–≤–µ—Å–µ–ª–∞—è –∏ —ç–Ω–µ—Ä–≥–∏—á–Ω–∞—è"
)
```

#### –ú—É–¥—Ä—ã–π –ø—Ä–æ—Ñ–µ—Å—Å–æ—Ä
```python
professor = CharacterConfig(
    name="–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä –ò–≤–∞–Ω–æ–≤",
    personality="–ú—É–¥—Ä—ã–π –∏ –æ–ø—ã—Ç–Ω—ã–π –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å —Å –≥–ª—É–±–æ–∫–∏–º–∏ –∑–Ω–∞–Ω–∏—è–º–∏ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –æ–±–ª–∞—Å—Ç—è—Ö –Ω–∞—É–∫–∏.",
    background="–ü—Ä–æ—Ñ–µ—Å—Å–æ—Ä —Å 30-–ª–µ—Ç–Ω–∏–º —Å—Ç–∞–∂–µ–º –ø—Ä–µ–ø–æ–¥–∞–≤–∞–Ω–∏—è –≤ —É–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç–µ.",
    speaking_style="–ì–æ–≤–æ—Ä–∏—Ç –∞–∫–∞–¥–µ–º–∏—á–Ω–æ, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω–æ, –ª—é–±–∏—Ç –ø—Ä–∏–≤–æ–¥–∏—Ç—å –ø—Ä–∏–º–µ—Ä—ã.",
    interests=["–Ω–∞—É–∫–∞", "–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ", "–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è", "—á—Ç–µ–Ω–∏–µ"],
    mood="—Å–ø–æ–∫–æ–π–Ω—ã–π –∏ –∑–∞–¥—É–º—á–∏–≤—ã–π"
)
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `MODEL_PATH` | –ü—É—Ç—å –∫ GGUF –º–æ–¥–µ–ª–∏ | - |
| `N_CTX` | –†–∞–∑–º–µ—Ä –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ | 4096 |
| `N_THREADS` | –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ—Ç–æ–∫–æ–≤ CPU | 8 |
| `N_BATCH` | –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ | 512 |

### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|----------|----------|--------------|
| `DEFAULT_MAX_TOKENS` | –ú–∞–∫—Å–∏–º—É–º —Ç–æ–∫–µ–Ω–æ–≤ | 512 |
| `DEFAULT_TEMPERATURE` | –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–∫—Ä–µ–∞—Ç–∏–≤–Ω–æ—Å—Ç—å) | 0.8 |
| `DEFAULT_TOP_P` | Top-p –ø–∞—Ä–∞–º–µ—Ç—Ä | 0.9 |
| `DEFAULT_TOP_K` | Top-k –ø–∞—Ä–∞–º–µ—Ç—Ä | 40 |
| `DEFAULT_REPEAT_PENALTY` | –®—Ç—Ä–∞—Ñ –∑–∞ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è | 1.1 |

## üì° API –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ë–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

```python
from app.chat_bot.services.llama_chat_service import llama_chat_service
from app.chat_bot.schemas.chat import ChatMessage, CharacterConfig, MessageRole

# –°–æ–∑–¥–∞–µ–º –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
character = CharacterConfig(
    name="–¢–µ—Å—Ç–æ–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂",
    personality="–û–ø–∏—Å–∞–Ω–∏–µ –ª–∏—á–Ω–æ—Å—Ç–∏",
    additional_context={}
)

# –°–æ–∑–¥–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
messages = [
    ChatMessage(
        role=MessageRole.USER,
        content="–ü—Ä–∏–≤–µ—Ç!",
        timestamp=None
    )
]

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç
response, metadata = await llama_chat_service.generate_response(
    messages=messages,
    character_config=character,
    max_tokens=100,
    temperature=0.8
)

print(f"–û—Ç–≤–µ—Ç: {response}")
print(f"–í—Ä–µ–º—è: {metadata['generation_time']:.2f}—Å")
```

### –ü—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–∏–∞–ª–æ–≥–∞

```python
# –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç–∞ –≤ –∏—Å—Ç–æ—Ä–∏—é
messages.append(ChatMessage(
    role=MessageRole.ASSISTANT,
    content=response,
    timestamp=None
))

# –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
messages.append(ChatMessage(
    role=MessageRole.USER,
    content="–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ",
    timestamp=None
))

# –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π –æ—Ç–≤–µ—Ç
response, metadata = await llama_chat_service.generate_response(
    messages=messages,
    character_config=character
)
```

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –í–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
ENABLE_CACHE: bool = True

# –†–∞–∑–º–µ—Ä –∫—ç—à–∞
MAX_CACHE_SIZE: int = 1000

# –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫—ç—à–∞
CACHE_TTL: int = 3600  # —Å–µ–∫—É–Ω–¥—ã
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
```python
# –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã
LOG_CHAT_REQUESTS: bool = True

# –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã
LOG_CHAT_RESPONSES: bool = False
```

### –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞
```python
# –í–∫–ª—é—á–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é
ENABLE_CONTENT_FILTER: bool = False

# –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ —Å–ª–æ–≤–∞
FORBIDDEN_WORDS: list = ["—Å–ª–æ–≤–æ1", "—Å–ª–æ–≤–æ2"]
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–æ–¥–µ–ª–∏
```python
info = llama_chat_service.get_model_info()
print(f"–°—Ç–∞—Ç—É—Å: {info['status']}")
print(f"–ü—É—Ç—å –∫ –º–æ–¥–µ–ª–∏: {info['model_path']}")
print(f"–†–∞–∑–º–µ—Ä –∫—ç—à–∞: {info['cache_size']}")
```

### –õ–æ–≥–∏
–õ–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `app/logs/` —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ:
- –ó–∞–≥—Ä—É–∑–∫–µ –º–æ–¥–µ–ª–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç–æ–≤
- –û—à–∏–±–∫–∞—Ö
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üêõ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥–µ–ª–∏
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ –º–æ–¥–µ–ª–∏ –≤ `chat_config.py`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –º–æ–¥–µ–ª–∏ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å .gguf)

### –ú–µ–¥–ª–µ–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è
1. –£–≤–µ–ª–∏—á—å—Ç–µ `N_THREADS` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –±–æ–ª—å—à–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —è–¥–µ—Ä
2. –£–º–µ–Ω—å—à–∏—Ç–µ `N_CTX` –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –ø–∞–º—è—Ç–∏
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–æ–ª–µ–µ –ª–µ–≥–∫—É—é –º–æ–¥–µ–ª—å

### –û—à–∏–±–∫–∏ –ø–∞–º—è—Ç–∏
1. –£–º–µ–Ω—å—à–∏—Ç–µ `N_CTX`
2. –£–º–µ–Ω—å—à–∏—Ç–µ `N_BATCH`
3. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥–µ–ª—å —Å –º–µ–Ω—å—à–∏–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## üìö –ü—Ä–∏–º–µ—Ä—ã

–°–º–æ—Ç—Ä–∏—Ç–µ –ø–∞–ø–∫—É `examples/` –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∏–º–µ—Ä–æ–≤:
- `chat_example.py` - –ø—Ä–∏–º–µ—Ä—ã —Ä–∞–∑–Ω—ã—Ö –ø–µ—Ä—Å–æ–Ω–∞–∂–µ–π
- `test_chat.py` - –ø—Ä–æ—Å—Ç–æ–π —Ç–µ—Å—Ç

## ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç

1. –§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
2. –°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏
3. –í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
4. –°–æ–∑–¥–∞–π—Ç–µ Pull Request

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –≤ `app/logs/`
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –º–æ–¥–µ–ª—å –∑–∞–≥—Ä—É–∂–µ–Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ `chat_config.py`
4. –°–æ–∑–¥–∞–π—Ç–µ Issue —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–æ–±–ª–µ–º—ã 